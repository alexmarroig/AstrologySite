{
  "openapi": "3.1.0",
  "info": {
    "title": "AstroLumen API",
    "version": "1.0.0",
    "description": "Backend para cálculo de mapa natal com Swiss Ephemeris."
  },
  "paths": {
    "/health": {
      "get": {
        "summary": "Health Check",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "status": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/v1/chart/natal": {
      "post": {
        "summary": "Generate natal chart",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/NatalChartRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Natal chart",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/NatalChartResponse"
                }
              }
            }
          }
        }
      }
    },
    "/services": {
      "get": {
        "summary": "Lista todos os serviços",
        "responses": {
          "200": {
            "description": "Lista de serviços",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/Service"
                  }
                }
              }
            }
          }
        }
      }
    },
    "/services/{slug}": {
      "get": {
        "summary": "Detalha um serviço pelo slug",
        "parameters": [
          {
            "name": "slug",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Serviço encontrado",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Service"
                }
              }
            }
          },
          "404": {
            "description": "Serviço não encontrado"
          }
        }
      }
    },
    "/profile": {
      "get": {
        "summary": "Perfil da astróloga",
        "responses": {
          "200": {
            "description": "Perfil completo",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Profile"
                }
              }
            }
          }
        }
      }
    },
    "/posts": {
      "get": {
        "summary": "Lista de posts do blog",
        "responses": {
          "200": {
            "description": "Posts resumidos",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/PostSummary"
                  }
                }
              }
            }
          }
        }
      }
    },
    "/posts/{id}": {
      "get": {
        "summary": "Detalhe de um post",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Post completo",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Post"
                }
              }
            }
          },
          "404": {
            "description": "Post não encontrado"
          }
        }
      }
    },
    "/stats": {
      "get": {
        "summary": "Métricas do AstroLumen",
        "responses": {
          "200": {
            "description": "Métricas atuais",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Stats"
                }
              }
            }
          }
        }
      }
    },
    "/openapi.json": {
      "get": {
        "summary": "Arquivo OpenAPI",
        "responses": {
          "200": {
            "description": "Especificação OpenAPI em JSON",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object"
                }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "NatalChartRequest": {
        "type": "object",
        "required": [
          "full_name",
          "birth_date",
          "birth_time",
          "birth_place"
        ],
        "properties": {
          "full_name": {
            "type": "string"
          },
          "birth_date": {
            "type": "string",
            "format": "date"
          },
          "birth_time": {
            "type": "string",
            "format": "time"
          },
          "birth_place": {
            "type": "string"
          },
          "language": {
            "type": "string",
            "enum": [
              "pt-BR",
              "en"
            ],
            "default": "pt-BR"
          },
          "house_system": {
            "type": "string",
            "enum": [
              "P",
              "K",
              "W",
              "O",
              "R",
              "C"
            ],
            "default": "P"
          },
          "zodiac": {
            "type": "string",
            "enum": [
              "tropical",
              "sidereal"
            ],
            "default": "tropical"
          },
          "sidereal_mode": {
            "type": "string"
          },
          "aspects": {
            "type": "object",
            "properties": {
              "orbs": {
                "type": "object",
                "properties": {
                  "conjunction": {
                    "type": "number",
                    "default": 8
                  },
                  "opposition": {
                    "type": "number",
                    "default": 8
                  },
                  "square": {
                    "type": "number",
                    "default": 6
                  },
                  "trine": {
                    "type": "number",
                    "default": 6
                  },
                  "sextile": {
                    "type": "number",
                    "default": 4
                  }
                }
              }
            }
          }
        }
      },
      "NatalChartResponse": {
        "type": "object",
        "properties": {
          "metadata": {
            "$ref": "#/components/schemas/ChartMetadata"
          },
          "points": {
            "$ref": "#/components/schemas/ChartPoints"
          },
          "houses": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/HouseCusp"
            }
          },
          "planets": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/PlanetPosition"
            }
          },
          "aspects": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/AspectEntry"
            }
          },
          "summary": {
            "type": "array",
            "items": {
              "type": "string"
            }
          }
        }
      },
      "ChartMetadata": {
        "type": "object",
        "properties": {
          "full_name": {
            "type": "string"
          },
          "birth_place": {
            "type": "string"
          },
          "birth_date": {
            "type": "string"
          },
          "birth_time": {
            "type": "string"
          },
          "timezone": {
            "type": "string"
          },
          "utc_datetime": {
            "type": "string"
          },
          "latitude": {
            "type": "number"
          },
          "longitude": {
            "type": "number"
          },
          "zodiac": {
            "type": "string"
          },
          "house_system": {
            "type": "string"
          },
          "sidereal_mode": {
            "type": "string"
          },
          "ephemeris_flags": {
            "type": "array",
            "items": {
              "type": "string"
            }
          }
        }
      },
      "ChartPoints": {
        "type": "object",
        "properties": {
          "asc": {
            "$ref": "#/components/schemas/SignPosition"
          },
          "mc": {
            "$ref": "#/components/schemas/SignPosition"
          },
          "vertex": {
            "$ref": "#/components/schemas/SignPosition"
          },
          "fortune": {
            "$ref": "#/components/schemas/SignPosition"
          }
        }
      },
      "SignPosition": {
        "type": "object",
        "properties": {
          "sign": {
            "type": "string"
          },
          "degree": {
            "type": "integer"
          },
          "minute": {
            "type": "integer"
          }
        }
      },
      "HouseCusp": {
        "type": "object",
        "properties": {
          "index": {
            "type": "integer"
          },
          "longitude": {
            "type": "number"
          },
          "sign": {
            "type": "string"
          },
          "degree": {
            "type": "integer"
          },
          "minute": {
            "type": "integer"
          }
        }
      },
      "PlanetPosition": {
        "type": "object",
        "properties": {
          "name": {
            "type": "string"
          },
          "longitude": {
            "type": "number"
          },
          "latitude": {
            "type": "number"
          },
          "speed": {
            "type": "number"
          },
          "sign": {
            "type": "string"
          },
          "degree": {
            "type": "integer"
          },
          "minute": {
            "type": "integer"
          },
          "house": {
            "type": "integer"
          },
          "retrograde": {
            "type": "boolean"
          }
        }
      },
      "AspectEntry": {
        "type": "object",
        "properties": {
          "planet1": {
            "type": "string"
          },
          "planet2": {
            "type": "string"
          },
          "type": {
            "type": "string"
          },
          "exact_angle": {
            "type": "number"
          },
          "orb": {
            "type": "number"
          },
          "applying": {
            "type": "boolean"
          }
        }
      },
      "ServiceDescription": {
        "type": "object",
        "properties": {
          "texto": {
            "type": "string"
          },
          "itens": {
            "type": "array",
            "items": {
              "type": "string"
            }
          }
        }
      },
      "ServiceArticleLink": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer"
          },
          "titulo": {
            "type": "string"
          },
          "slug": {
            "type": "string"
          }
        }
      },
      "Service": {
        "type": "object",
        "properties": {
          "slug": {
            "type": "string"
          },
          "nome": {
            "type": "string"
          },
          "resumo": {
            "type": "string"
          },
          "preco": {
            "type": "number"
          },
          "imagem": {
            "type": "string"
          },
          "descricao_completa": {
            "$ref": "#/components/schemas/ServiceDescription"
          },
          "links_artigos": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/ServiceArticleLink"
            }
          },
          "categorias": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "tipo_entrega": {
            "type": "string"
          }
        }
      },
      "Contato": {
        "type": "object",
        "properties": {
          "telefone": {
            "type": "string"
          },
          "whatsapp": {
            "type": "string"
          },
          "email": {
            "type": "string"
          },
          "endereco": {
            "type": "string"
          }
        }
      },
      "RedesSociais": {
        "type": "object",
        "properties": {
          "instagram": {
            "type": "string"
          },
          "youtube": {
            "type": "string"
          },
          "tiktok": {
            "type": "string"
          }
        }
      },
      "FAQItem": {
        "type": "object",
        "properties": {
          "pergunta": {
            "type": "string"
          },
          "resposta": {
            "type": "string"
          }
        }
      },
      "Profile": {
        "type": "object",
        "properties": {
          "nome": {
            "type": "string"
          },
          "foto": {
            "type": "string"
          },
          "formacao": {
            "type": "string"
          },
          "experiencia": {
            "type": "string"
          },
          "biografia": {
            "type": "string"
          },
          "citacao": {
            "type": "string"
          },
          "contato": {
            "$ref": "#/components/schemas/Contato"
          },
          "redes_sociais": {
            "$ref": "#/components/schemas/RedesSociais"
          },
          "beneficios": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "faq": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/FAQItem"
            }
          }
        }
      },
      "PostSummary": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer"
          },
          "titulo": {
            "type": "string"
          },
          "resumo": {
            "type": "string"
          },
          "imagem": {
            "type": "string"
          },
          "autor": {
            "type": "string"
          },
          "data_publicacao": {
            "type": "string",
            "format": "date"
          }
        }
      },
      "Post": {
        "type": "object",
        "allOf": [
          {
            "$ref": "#/components/schemas/PostSummary"
          },
          {
            "type": "object",
            "properties": {
              "conteudo": {
                "type": "string"
              },
              "tags": {
                "type": "array",
                "items": {
                  "type": "string"
                }
              }
            }
          }
        ]
      },
      "Stats": {
        "type": "object",
        "properties": {
          "interpretacoes_realizadas": {
            "type": "integer"
          },
          "mapas_gerados": {
            "type": "integer"
          },
          "satisfacao_media": {
            "type": "number"
          },
          "avaliacoes": {
            "type": "integer"
          }
        }
      }
    }
  }
}
